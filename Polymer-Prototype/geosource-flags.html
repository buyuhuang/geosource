<link rel="import" href="components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="components/core-menu/core-submenu.html">

<polymer-element name="geosource-flags" attributes="uid">

  <template>
    
    <style>
      :host {
        display: block;
        position: relative;
        background-color: white;
        width: 100%;
        font-weight: 300;
      }
      .toggle_label {
        margin: 15px;
        margin-left: 0;
      }
      core-submenu {
        padding: 10px;
      }
      core-submenu::shadow #submenu {
        margin-left: 15px;
      }
    </style>

    <core-submenu opened active id="core_submenu" icon="flag" label="Flags">
      <div on-change="{{toggleButton}}">
        <div center horizontal layout class="toggle_label">
          <div flex>All</div>
          <paper-toggle-button id="all_toggle_button" checked
            on-change="{{toggleAll}}">
          </paper-toggle-button>
        </div>
        <div center horizontal layout class="toggle_label">
          <div flex>Mine</div>
          <paper-toggle-button id="mine_toggle_button" checked disabled></paper-toggle-button>
        </div>
        <div center horizontal layout class="toggle_label">
          <div flex>Favorites</div>
          <paper-toggle-button id="favorite_toggle_button" checked disabled></paper-toggle-button>
        </div>
      </div>
    </core-submenu>

  </template>

  <script>
    Polymer({

      uid: null,

      /**
       * When the all flag is turned off, the other flags within this component
       * become active. When it is turned on, the other flags are disabled.
       */
      toggleAll: function(e) {
        var all_toggle = this.$.all_toggle_button;
        var fav_toggle = this.$.favorite_toggle_button;
        var mine_toggle = this.$.mine_toggle_button;
        if(all_toggle.checked) {
          fav_toggle.disabled = true;
          mine_toggle.disabled = true;
        }
        else {
          fav_toggle.disabled = false;
          mine_toggle.disabled = false;
        }
      },

      /**
       * Fires a filter-change event, which is caught by geosource-main to
       * determine that the posts should be re-filtered.
       */
      toggleButton: function() {
        this.fire('filter-change');
      },

      /**
       * Given a set of posts, this returns the subset of those posts which are 
       * applicable to the flags currently active within this component's state.
       */
      filterPosts: function(posts) {
        var all = this.$.all_toggle_button.checked;
        var fav = this.$.favorite_toggle_button.checked;
        var mine = this.$.mine_toggle_button.checked;

        var includedPosts = [];
        for(i=0; i<posts.length; i++) {
          if((all) || (!all && fav && posts[i].favorite) || mine && posts[i].uid == this.uid) {
            includedPosts.push(posts[i]);
          }
        }
        return includedPosts;
      },

    });
  </script>

</polymer-element>