<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-item/core-item.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../core-menu/core-submenu.html">
<link rel="import" href="../core-icons/core-icons.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-dropdown/paper-dropdown.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../core-icon/core-icon.html" >
<link rel="import" href="../core-icons/core-icons.html" >
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">

<link rel="import" href="../core-icons/image-icons.html">
<link rel="import" href="../core-icons/av-icons.html">
<link rel="import" href="../paper-radio-button/paper-radio-button.html">
<link rel="import" href="../geosource-services/post-service.html">
<link rel="import" href="../paper-radio-group/paper-radio-group.html">

<link rel="import" href="../disqus-comments/disqus-comments.html">

<polymer-element name="geosource-post" attributes="pid">

  <template>

    <style>

      #close {
        position: fixed;
        background-color: rgba(255, 113, 113, 0.89);
        color: #fff;
        border-radius: 100%;

      }

      h2 {
        margin-top: 0;
        margin-bottom: 0;
      }

      h3 {
        margin-bottom: 0;
      }

      :host {
        display: block;
        position: relative;
        background-color: white;
        width: 100%;
        font-weight: 300;
      }

      .post {
        overflow-x: auto;
        padding: 40px;
      }

      .header {
        margin: 0;
        font-size: 1.8em;
        color: #000000;
      }

      .footer {
        font-size: 14px;
        color: #636363;
        text-transform: uppercase;
        padding-top: 10px;
        padding-bottom: 10px;
      }

      video {
        background-color: #000000;
        width: auto;
        height: auto;
      }

      audio {
        width: auto;
      }

      img {
        width: 100%;
        height: auto;
      }

      .checkbox {
        padding: 20px;
        padding-left: 0;
        padding-bottom: 0;
      }

      .checkbox-label {
        padding-left: 15px;
      }

      disqus-comments {
        margin-top: 20px;
      }

    </style>

    <post-service id="post_service" post="{{post}}" pid="{{pid}}"></post-service>

    <div class="post" vertical layout>
      <div class="header" horizontal layout>
        <h2 flex>{{post.title}}</h2>
        <paper-icon-button id="close" icon="close" on-tap="{{close}}"></paper-icon-button>
      </div>
      <div class="footer">posted by {{post.username}} {{time}} to {{post.channel}}</div>
      <div class="content" id="content" vertical layout></div>
      
      <disqus-comments 
        id="disqus"
        shortname="hoopsnake-geosource" 
        identifier="{{post.pid + 'removethis'}}" 
        url="{{'http://www.okenso.com/#!/post/' + post.pid + 'removethis'}}"
        title="{{post.title}}">
      </disqus-comments>
    </div>

  </template>


  <script>
  Polymer({

    pid: null,
    time: null,
    post: null,

    pidChanged: function() {
      this.$.post_service.load(this.pid);
    },

    postChanged: function() {

      this.$.disqus.reset();

      this.time = moment(this.post.time).fromNow();

      content = "";

      for(i=0; i<this.post.fields.length; i++) {

        switch(this.post.fields[i].type) {
          case "Video":
            content += '<h3>' + this.post.fields[i].label + '</h3>';
            content += 
              '<video width="auto" height="auto" controls>' +
                '<source src="' + this.post.fields[i].value + '" type="video/mp4">' +
                'Your browser does not support the video tag.' +
              '</video>';
            break;
          case "Audio":
            content += '<h3>' + this.post.fields[i].label + '</h3>';
            content += 
              '<audio controls>' +
                '<source src="' + this.post.fields[i].value + '" type="audio/mpeg">' +
                'Your browser does not support the audio element.' +
              '</audio>';
            break;
          case "Image":
            content += '<h3>' + this.post.fields[i].label + '</h3>';
            content += '<img src="' + this.post.fields[i].value + '">';
            break;
          case "Text":
            content += '<h3>' + this.post.fields[i].label + '</h3>';
            content += '<div>' + this.post.fields[i].value + '</div>';
            break;
          case "Checkbox":
            content += '<div class="checkbox" horizontal layout><paper-checkbox' 
            if(this.post.fields[i].value) {
              content += ' checked'
            }
            content += ' disabled></paper-checkbox><div class="checkbox-label">' + this.post.fields[i].label + '</div></div>'
            break;
          case "Radio Button":
            content += '<div class="checkbox" horizontal layout><paper-radio-button' 
            if(this.post.fields[i].value) {
              content += ' checked'
            }
            content += ' disabled></paper-radio-button><div class="checkbox-label">' + this.post.fields[i].label + '</div></div>'
            break;


        }
      }

      this.$.content.innerHTML = content;

      this.fire('post-loaded');
    },

    close: function() {
      this.fire('close');
    }

  });
  </script>
  
</polymer-element>
