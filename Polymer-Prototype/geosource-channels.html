<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/core-item/core-item.html">
<link rel="import" href="components/paper-input/paper-input.html">

<polymer-element name="geosource-channels" attributes="channels">

  <template>

    <style>
      :host {
        display: block;
        position: relative;
        background-color: white;
        width: 100%;
        font-weight: 300;
      }
      paper-input {
        padding-bottom: 10px;
      }
      core-submenu {
        padding: 10px;
      }
      core-submenu::shadow #submenu {
        margin-left: 15px;
      }
/*      core-item.core-selected {
        color: #3C8670;
      }*/
      .unsubscribe_button {
        color: #FF6666;
      }
      #subscribed {
        padding: 0;
      }
      core-menu {
        margin: 0;
      }
    </style>

    <core-submenu opened active selected="0" icon="settings" label="Channels" on-core-select="{{channelSelected}}">
      <core-menu selected="0">
        <core-item label="All" horizontal center layout selected></core-item>
        <core-submenu id="subscribed" label="Subscribed">
          <template repeat="{{channel in subscribedChannels}}">
              <core-item label="{{channel.name}}" horizontal justified layout>
                <paper-icon-button icon="close" class="unsubscribe_button"></paper-icon-button>
              </core-item>
          </template>
        </core-submenu>
      </core-menu>
      <div center horizontal layout class="search">
        <paper-input label="Search for channels..."></paper-input>
        <paper-icon-button icon="search"></paper-icon-button> 
     </div>
    </core-submenu>
  </template>

  <script>
  Polymer({

    selected: "All",
    channels: null,
    subscribedChannels: null,

    channelsChanged: function(){
      this.subscribedChannels = []
      for(i=0; i<this.channels.length; i++) {
        if(this.channels[i].subscribed) {
          this.subscribedChannels.push(this.channels[i])
        }
      }
    },

    /**
     * Fires a 'selection-change' event, and changes the 'selected' attribute to
     * whichever attribute has been selected.
     */
    channelSelected: function(e) {
      this.selected = e.detail.item.label;
      console.log('selected channel', this.selected);
      this.$.subscribed.selected = false;
      this.fire('filter-change');
    },

    filterPosts: function(posts) {
      var includedPosts = [];

      switch (this.selected) {
        case 'All':
          includedPosts = posts.slice(0);
          break;
        case 'Subscribed':
          for(i=0; i<posts.length; i++) {
            for(j=0; j<this.subscribedChannels.length; j++) {
              if(posts[i].channel == this.subscribedChannels[j].name)
              {
                includedPosts.push(posts[i]);
                break;
              }
            }
          }
          break;
        default:
          for(i=0; i<posts.length; i++) {
            if(posts[i].channel == this.selected) {
              includedPosts.push(posts[i]);
            }
          }
          break;
      }

      return includedPosts;
    },
  });
  </script>
  
</polymer-element>
